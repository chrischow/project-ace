// * ---------- *
// | PAGE: TEAM |
// * ---------- *
// #FAKEDATA
const annualOkrs = [
    {
        objectiveId: 1, title: 'Annual O1', description: 'Annual O1 description', progress: 0.12,
        keyResults: [
            {title: 'Annual O1 KR1', description: 'Annual O1 KR1 description', progress: 0.11},
            {title: 'Annual O1 KR2', description: 'Annual O1 KR2 description', progress: 0.12},
            {title: 'Annual O1 KR3', description: 'Annual O1 KR3 description', progress: 0.13},
        ]
    },
    {
        objectiveId: 2, title: 'Annual O2', description: 'Annual O2 description', progress: 0.22,
        keyResults: [
            {title: 'Annual O2 KR1', description: 'Annual O2 KR1 description', progress: 0.21},
            {title: 'Annual O2 KR2', description: 'Annual O2 KR2 description', progress: 0.22},
            {title: 'Annual O2 KR3', description: 'Annual O2 KR3 description', progress: 0.23},
        ]
    },
    {
        objectiveId: 3, title: 'Annual O3', description: 'Annual O3 description', progress: 0.32,
        keyResults: [
            {title: 'Annual O3 KR1', description: 'Annual O3 KR1 description', progress: 0.31},
            {title: 'Annual O3 KR2', description: 'Annual O3 KR2 description', progress: 0.32},
            {title: 'Annual O3 KR3', description: 'Annual O3 KR3 description', progress: 0.33},
        ]
    },
];

const quarterlyOkrs = [
    {
        objectiveId: 4, title: 'Quarterly O1', description: 'Quarterly O1 description', progress: 0.42,
        keyResults: [
            {title: 'Quarterly O1 KR1', description: 'Quarterly O1 KR1 description', progress: 0.41},
            {title: 'Quarterly O1 KR2', description: 'Quarterly O1 KR2 description', progress: 0.42},
            {title: 'Quarterly O1 KR3', description: 'Quarterly O1 KR3 description', progress: 0.43},
        ]
    },
    {
        objectiveId: 5, title: 'Quarterly O2', description: 'Quarterly O2 description', progress: 0.52,
        keyResults: [
            {title: 'Quarterly O2 KR1', description: 'Quarterly O2 KR1 description', progress: 0.51},
            {title: 'Quarterly O2 KR2', description: 'Quarterly O2 KR2 description', progress: 0.52},
            {title: 'Quarterly O2 KR3', description: 'Quarterly O2 KR3 description', progress: 0.53},
        ]
    },
    {
        objectiveId: 6, title: 'Quarterly O3', description: 'Quarterly O3 description', progress: 0.62,
        keyResults: [
            {title: 'Quarterly O3 KR1', description: 'Quarterly O3 KR1 description', progress: 0.61},
            {title: 'Quarterly O3 KR2', description: 'Quarterly O3 KR2 description', progress: 0.62},
            {title: 'Quarterly O3 KR3', description: 'Quarterly O3 KR3 description', progress: 0.63},
        ]
    },
];

const monthlyOkrs = [
    {
        objectiveId: 7, title: 'Monthly O1', description: 'Monthly O1 description', progress: 0.72,
        keyResults: [
            {title: 'Monthly O1 KR1', description: 'Monthly O1 KR1 description', progress: 0.71},
            {title: 'Monthly O1 KR2', description: 'Monthly O1 KR2 description', progress: 0.72},
            {title: 'Monthly O1 KR3', description: 'Monthly O1 KR3 description', progress: 0.73},
        ]
    },
    {
        objectiveId: 8, title: 'Monthly O2', description: 'Monthly O2 description', progress: 0.82,
        keyResults: [
            {title: 'Monthly O2 KR1', description: 'Monthly O2 KR1 description', progress: 0.81},
            {title: 'Monthly O2 KR2', description: 'Monthly O2 KR2 description', progress: 0.82},
            {title: 'Monthly O2 KR3', description: 'Monthly O2 KR3 description', progress: 0.83},
        ]
    },
    {
        objectiveId: 9, title: 'Monthly O3', description: 'Monthly O3 description', progress: 0.92,
        keyResults: [
            {title: 'Monthly O3 KR1', description: 'Monthly O3 KR1 description', progress: 0.91},
            {title: 'Monthly O3 KR2', description: 'Monthly O3 KR2 description', progress: 0.92},
            {title: 'Monthly O3 KR3', description: 'Monthly O3 KR3 description', progress: 0.93},
        ]
    },
];

const teamData = {
    annual: {
        objectiveCompletion: {completed: 1, total: 3},
        keyResultCompletion: {completed: 3, total: 9},
        avgCompletion: 0.22,
        okrs: annualOkrs
    },
    quarterly: {
        objectiveCompletion: {completed: 2, total: 6},
        keyResultCompletion: {completed: 6, total: 18},
        avgCompletion: 0.52,
        okrs: quarterlyOkrs
    },
    monthly: {
        objectiveCompletion: {completed: 3, total: 9},
        keyResultCompletion: {completed: 9, total: 27},
        avgCompletion: 0.82,
        okrs: monthlyOkrs
    }
    
};

const o1 = {
    objectiveId: 1,
    title: 'Enhance the quality and volume of data collection and visibility',
    description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris consequat massa quis ornare rutrum. Pellentesque mattis neque malesuada volutpat ultricies. Maecenas sed vestibulum arcu. Aliquam in viverra nulla, non sodales.',
    progress: 0.213,
    keyResults: [
        {
            title: 'Proliferate 6 x MS Stack solutions',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.17
        },
        {
            title: 'Complete all 4 tracks of OCTANE',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.05
        },
        {
            title: 'Create a data catalogue and ingest 12 datasets',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.42
        }
    ]
};

const o2 = {
    objectiveId: 2,
    title: 'Enhance data-driven decision making in ground offices',
    description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris consequat massa quis ornare rutrum. Pellentesque mattis neque malesuada volutpat ultricies. Maecenas sed vestibulum arcu. Aliquam in viverra nulla, non sodales.',
    progress: 0.3888,
    keyResults: [
        {
            title: 'Complete 6 x office-level use cases',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.17
        },
        {
            title: 'Organise 6 x bi-monthly DA Boards',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.6667
        },
        {
            title: 'Improve 3 x dashboard reports',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.333
        }
    ]
};

const o3 = {
    objectiveId: 3,
    title: 'Improve the DM/DA toolkit',
    description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris consequat massa quis ornare rutrum. Pellentesque mattis neque malesuada volutpat ultricies. Maecenas sed vestibulum arcu. Aliquam in viverra nulla, non sodales.',
    progress: 0.16667,
    keyResults: [
        {
            title: 'Implement 2 x NLP use cases in the Lab',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0
        },
        {
            title: 'Distribute a MS Stack Access template',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0
        },
        {
            title: 'Deploy 2 x MS Stack 2.0 solutions',
            description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            progress: 0.5
        }
    ]
};

function ProgressBar(props) {
    const progressNow = Math.round(100 * Number(props.progress));
    const progressNowString = String(progressNow) + '%';

    const progressStyle = {
        width: progressNowString
    };

    const progressClass = props.isKeyResult ? "progress progress-keyresult" : "progress";

    return (
        <div className="row align-items-center mt-3">
            <div className="col-11">
                <div className={progressClass}>
                    <div
                        className="progress-bar"
                        role="progressbar"
                        aria-valuemin="0"
                        aria-valuemax="100"
                        aria-valuenow={progressNow}
                        style={progressStyle}
                    ></div>
                </div>
            </div>
            <div className="col-1">
                <span className="objective-card--progress-text">{progressNowString}</span>
            </div>
        </div>
    );
};

function KeyResultCard(props) {
    return (
        <div className="keyresult-card">
            <h4 className="keyresult-card--tag">Key Result</h4>
            <h4 className="keyresult-card--title mt-2">
                {props.title}
            </h4>
            <p className="keyresult-card--description mt-1">
                {props.description}
            </p>
            <ProgressBar progress={props.progress} isKeyResult={true} />
        </div>
    );
}

function ObjectiveCard(props) {
    const [isClicked, setIsClicked] = React.useState(false);

    const objId = 'obj-' + props.objectiveId;

    function updateArrow() {
        $('#' + objId).on('show.bs.collapse', () => setIsClicked(true));
        $('#' + objId).on('hide.bs.collapse', () => setIsClicked(false));
    }

    return (
        <button
            className="btn objective-card text-left"
            data-toggle="collapse"
            data-target={'#' + objId}
            type="button"
            aria-expanded="false"
            aria-controls={objId}
            onClick={updateArrow}
            id={'btn-' + objId}
        >
            <h4 className="objective-card--tag mb-3">Objective</h4>
            <div className={isClicked ? "arrow-down" : "arrow-right"}></div>
            <h4 className="objective-card--title mt-2">
                {props.title}
            </h4>
            <p className="objective-card--description mt-1">
                {props.description}
            </p>
            <ProgressBar progress={props.progress} />
        </button>
    );
};

function ObjectiveCardGroup(props) {
    // Create KR Cards
    const objId = 'obj-' + props.objectiveId;

    const keyResultCards = props.keyResults.map(function(item) {
        return <KeyResultCard {...item} />
    });

    return (
        <div className="mt-4">
            <ObjectiveCard {...props} />
            <div class="collapse" id={objId}>
                {keyResultCards}
            </div>
        </div>
    );
};

function FrequencyTabs(props) {
    return (
        <div className="mt-4">
            <ul className="nav nav-pills justify-content-center" role="tablist">
                <li className="nav-item">
                    <a
                        className="nav-link frequency-tabs--link active"
                        data-toggle="tab"
                        role="tab"
                        aria-selected="true"
                        aria-controls="annual"
                        href="#team-annual"
                        onClick={() => props.changeFrequency('annual')}
                    >
                            Annual
                    </a>
                </li>
                <li className="nav-item">
                    <a
                        className="nav-link frequency-tabs--link"
                        data-toggle="tab"
                        role="tab"
                        aria-selected="false"
                        aria-controls="quarterly"
                        href="#team-quarterly"
                        onClick={() => props.changeFrequency('quarterly')}
                    >
                            Quarterly
                    </a>
                </li>
                <li className="nav-item">
                    <a
                        className="nav-link frequency-tabs--link"
                        data-toggle="tab"
                        role="tab"
                        aria-selected="false"
                        aria-controls="monthly"
                        href="#team-monthly"
                        onClick={() => props.changeFrequency('monthly')}
                    >
                            Monthly
                    </a>
                </li>
            </ul>
        </div>
    );
}

function TestPills(props) {
    return (
        <h3>{props.frequency} selected</h3>
    )
}

class TeamPageBody extends React.Component {
    constructor(props) {
        super(props)
        this.state = {
            frequency: 'annual',
            data: teamData['annual']
        };
    }

    changeFrequency = (frequency) => {
        this.setState({
            frequency: frequency,
            data: teamData[frequency]
        });

        $('#team-progress').circleProgress('value', teamData[frequency].avgCompletion);
        // Re-draw
        $('#team-progress').circleProgress();
    }

    componentDidMount() {
        updateCircleProgress('team-progress', this.state.data.avgCompletion, 220, '50px', '#000718');
    }

    render() {
        const progressData = {
            objectiveCompletion: this.state.data.objectiveCompletion,
            keyResultCompletion: this.state.data.keyResultCompletion
        };

        const objectiveCardGroups = this.state.data.okrs.map(function(item) {
            return <ObjectiveCardGroup {...item} />
        });

        return (
            <div>
                <FrequencyTabs changeFrequency={this.changeFrequency} />
                <div className="tab-content" id="team-tabcontent">
                    <TestPills frequency={this.state.frequency} />
                </div>
                <h3 className="mt-4">Team Progress</h3>
                <div className="overall-panel mt-4">
                    <ProgressCard progressId="team-progress" data={progressData} isTeam={false} />
                </div>
                <h3 className="mt-5">Objectives & Key Results</h3>
                {objectiveCardGroups}
            </div>
        );
    }
}

function TeamPage(props) {
    return (
        <div>
            <h1 className="mb-3">{props.team.teamName}</h1>
            <TeamPageBody />
        </div>
    );
};


// <div className="tab-content" id="team-tabcontent">
//     <div className="tab-pane fade show active" id="#team-annual" role="tabpanel" aria-labelledby="annual-tab">
//         <h3>Annual</h3>
//     </div>
//     <div className="tab-pane fade" id="#team-quarterly" role="tabpanel" aria-labelledby="quarterly-tab">
//         <h3>Quarterly</h3>
//     </div>
//     <div className="tab-pane fade" id="#team-monthly" role="tabpanel" aria-labelledby="monthly-tab">
//         <h3>Monthly</h3>
//     </div>
// </div>