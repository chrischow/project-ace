<!DOCTYPE html>
<html>
    <head>
        <title>ROKR - RAiD OKR Management Platform</title>

        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="../css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" type="text/css" href="styles.css">

        <!-- Load utils -->
        <script type="text/javascript">
            function loadWords(filename, asynch) {
                // Retrieve text
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var sTag = document.createElement('script');
                        sTag.type = 'text/javascript';
                        sTag.innerHTML = this.responseText;
                        var head = document.getElementsByTagName('head')[0];
                        head.appendChild(sTag);
                    }
                };
                var url = 'https://raw.githubusercontent.com/chrischow/project-ace/main/txt/' + filename + '.txt';
                xhr.open('GET', url, asynch);
                xhr.send();
            };

            function loadComponent(component) {
                // Retrieve text
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var sTag = document.createElement('script');
                        sTag.type = 'text/babel';
                        sTag.innerHTML = this.responseText;
                        var head = document.getElementsByTagName('head')[0];
                        head.appendChild(sTag);
                    }
                };
                var url = 'https://raw.githubusercontent.com/chrischow/project-ace/main/rokr/components/' + component + '.txt';
                
                xhr.open('GET', url, false);
                xhr.send();
            }

            // Load utils
            loadWords('jquery-3.2.1.min', false);
            loadWords('bootstrap-4.6.0.min', true);
            loadWords('jquery.dataTables-1.10.20.min', false);
            loadWords('dataTables.bootstrap4-1.10.20.min', true);
            loadWords('react.production.min', false);
            loadWords('react-dom.production.min', false);
            loadWords('react-router-dom.min', false);
            loadWords('babel-6.26.0.min', false);
            loadWords('circle-progress.min', false);
            loadWords('update-circle-progress', false);
            
            // Routing
            const BrowserRouter = ReactRouterDOM.HashRouter;
            const Route = ReactRouterDOM.Route;
            const Switch = ReactRouterDOM.Switch;
            const Link = ReactRouterDOM.Link;
            const NavLink = ReactRouterDOM.NavLink;

            // Load components
            loadComponent('brand');
            loadComponent('navbar');
            loadComponent('home');
            loadComponent('team');

            // Configs
            var teams = [
                {teamName: 'HQ RAiD', slug: 'hq-raid'},
                {teamName: 'SWiFT', slug: 'swift'},
                {teamName: 'RDO', slug: 'rdo'},
                {teamName: 'CyDef', slug: 'cydef'},
                {teamName: 'SES', slug: 'ses'}
            ];
        </script>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel">
            // State
            //  - Query SPList everytime each Team page is reloaded?
            //  - This is in case updates were made --> Need to update
            // #FAKEDATA
            const progress = [
                Math.random(), Math.random(), Math.random(), Math.random(), Math.random()
            ];

            const overallProgressData = {
                objective: { completed: 11, total: 15 },
                keyResults: { completed: 33, total: 45 }
            };

            const teamProgressData = [
                {
                    objective: { completed: 11, total: 15 },
                    keyResults: { completed: 33, total: 45 }
                },
                {
                    objective: { completed: 11, total: 15 },
                    keyResults: { completed: 33, total: 45 }
                },
                {
                    objective: { completed: 11, total: 15 },
                    keyResults: { completed: 33, total: 45 }
                },
                {
                    objective: { completed: 11, total: 15 },
                    keyResults: { completed: 33, total: 45 }
                },
                {
                    objective: { completed: 11, total: 15 },
                    keyResults: { completed: 33, total: 45 }
                },
            ];

            // Routes
            const Routes = (props) => {
                const routes = props.teams.map(function(team) {
                    
                    return (
                        <Route 
                            key={team.slug}
                            path={'/' + team.slug}
                            render={(props) => <TeamPage team={team} />}
                        />
                    );
                });
                return (
                    <div>
                    {routes}
                    </div>
                );
            }
            
            function renderHome(props) {
                return (
                    <Home
                        teams={teams}
                        overallData={overallProgressData}
                        teamProgressData={teamProgressData}
                    />
                );
            }

            // App
            function App() {
                return (
                    <BrowserRouter>
                        <Navbar teams={teams} />
                        <div className="container mt-5">
                            <Switch>
                                <Route 
                                    path='/'
                                    render={renderHome}
                                    exact
                                />

                                <Routes teams={teams} />
                            </Switch>
                        </div>
                    </BrowserRouter>
                )
            }

            // Render
            ReactDOM.render(
                <App />,
                document.getElementById('root')
            );
        </script>
    </body>
</html>