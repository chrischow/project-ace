<!DOCTYPE html>
<html>
    <head>
        <title>ROKR - RAiD OKR Management Platform</title>
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="../css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" type="text/css" href="styles.css">

        <!-- Load utils -->
        <script type="text/javascript">
            function loadWords(filename, asynch) {
                // Retrieve text
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var sTag = document.createElement('script');
                        sTag.type = 'text/javascript';
                        sTag.innerHTML = this.responseText;
                        var head = document.getElementsByTagName('head')[0];
                        head.appendChild(sTag);
                    }
                };
                var url = 'https://raw.githubusercontent.com/chrischow/project-ace/main/txt/' + filename + '.txt';
                xhr.open('GET', url, asynch);
                xhr.send();
            };

            function loadComponent(component) {
                // Retrieve text
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var sTag = document.createElement('script');
                        sTag.type = 'text/babel';
                        sTag.innerHTML = this.responseText;
                        var head = document.getElementsByTagName('head')[0];
                        head.appendChild(sTag);
                    }
                };
                var url = 'https://raw.githubusercontent.com/chrischow/project-ace/main/rokr/components/' + component + '.txt';
                
                xhr.open('GET', url, false);
                xhr.send();
            }

            // Load utils
            loadWords('jquery-3.2.1.min', false);
            loadWords('bootstrap-4.6.0.min', false);
            loadWords('jquery.dataTables-1.10.20.min', false);
            loadWords('dataTables.bootstrap4-1.10.20.min', false);
            loadWords('react.production.min', false);
            loadWords('react-dom.production.min', false);
            loadWords('react-router-dom.min', false);
            loadWords('babel-6.26.0.min', false);
            loadWords('circle-progress.min', false);
            
            // Routing
            const BrowserRouter = ReactRouterDOM.HashRouter;
            const Route = ReactRouterDOM.Route;
            const Switch = ReactRouterDOM.Switch;
            const Link = ReactRouterDOM.Link;
            const NavLink = ReactRouterDOM.NavLink;

            // Load components
            loadComponent('navbar');
            loadComponent('home');

            // Configs
            var teams = [
                {teamName: 'HQ RAiD', slug: 'hq-raid'},
                {teamName: 'SWiFT', slug: 'swift'},
                {teamName: 'RDO', slug: 'rdo'},
                {teamName: 'CyDef', slug: 'cydef'},
                {teamName: 'SES', slug: 'ses'}
            ];
        </script>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel">
            // State
            //  - Query SPList everytime each Team page is reloaded?
            //  - This is in case updates were made --> Need to update

            // Team page
            const Team = (props) => {
                return (
                    <h1>{props.team.teamName}</h1>
                );
            }

            // Routes
            const Routes = (props) => {
                const routes = props.teams.map(function(team) {
                    console.log(team);
                    return (
                        <Route 
                            key={team.slug}
                            path={'/' + team.slug}
                            render={(props) => <Team team={team} />}
                        />
                    );
                });
                return (
                    <div>
                    {routes}
                    </div>
                );
            }

            // App
            function App() {
                return (
                    <BrowserRouter>
                        <Navbar teams={teams} />
                        <div className="container mt-5">
                            <div id="comm-progress" class="progress-circle text-center"></div>
                            <Switch>
                                <Route path='/' render={(props) => <Home teams={teams} />} exact />
                                <Routes teams={teams} />
                            </Switch>
                        </div>
                    </BrowserRouter>
                )
            }

            // Render
            ReactDOM.render(
                <App />,
                document.getElementById('root')
            );
        </script>
        <script type="text/javascript">
            $(document).ready(function() {
                var comm_progress = $('#comm-progress').circleProgress({
                    value: 20 / 100,     // Completion here
                    //value: 0.70,
                    size: progressRingSize,
                    startAngle: - Math.PI / 2,
                    fill: {
                        //gradient: ['#1B37DB', '#66fcf1']
                        color: '#090637'
                    }
                });
    
                comm_progress.on('circle-animation-progress', function(e, v) {
                    var obj = $(this).data('circle-progress'),
                        ctx = obj.ctx,
                        s = obj.size,
                        sv = (20 / 100 * v).toFixed() + "%",
                        fill = obj.arcFill;
                        // fill = "#007bff"
            
                    ctx.save();
                    ctx.font = progressRingFontSize;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillStyle = fill;
                    ctx.fillText(sv, s / 2, s / 2);
                    ctx.restore();
                });
            });
        </script>
    </body>
</html>